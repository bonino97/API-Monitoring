var VHX=VHX||{};VHX.Class=VHX.Class||{},VHX.Utils=VHX.Utils||{};var getCookie=function(e){var t=document.cookie.match("\\b"+e+"=([^;]*)\\b");return t?t[1]:null},gdprProtected=function(){return-1!=window.location.href.indexOf("no_cookies=1")||"0"===getCookie("gcp")},isTrackingDisabled=function(){return _current_site?gdprProtected()||_current_site.made_for_kids&&_current_site.made_for_kids_tracking_blocked:gdprProtected()};VHX.Class.Tracker=function(){var i,o=this;return o.local={settings:{},request:{}},i=o.local,o.init=function(){isTrackingDisabled()||(i.settings="undefined"!=typeof _vhx?_vhx:null,o.isEnabled()&&o.processRequest())},o.processRequest=function(){i.request={affiliate:o.getAffiliate(),campaign:o.getCampaign(),country:o.getCountry(),platform:o.getPlatform(),referrer:o.getReferrer(),ref:o.getQueryParam("ref"),utm_source:o.getQueryParam("utm_source"),utm_medium:o.getQueryParam("utm_medium"),utm_term:o.getQueryParam("utm_term"),utm_content:o.getQueryParam("utm_content"),utm_campaign:o.getQueryParam("utm_campaign")},o.isUnique()&&(o.writeCookie(),o.isTracked()||o.flushToCollector())},o.isEnabled=function(){return!window.location.pathname.match(/admin|watch/i)&&(null!==i.settings&&("environment"in i.settings&&"site"in i.settings&&"geo"in i.settings&&("id"in i.settings.site&&"domain"in i.settings.site&&"host"in i.settings.site)))},o.isUnique=function(){var e,t=o.readCookie(),r=["affiliate","campaign","referrer","country","ref"];if(null===t||t.site_id!=i.settings.site.id)return!0;for(e in r)if(i.request[r[e]]&&i.request[r[e]]!=t[r[e]])return!0;return!1},o.isTracked=function(){return 0<o.getQueryParam("uid").length},o.getReferrer=function(){var e,t,r=o.getQueryParam("referrer")||document.referrer;return r.match(/vhx.tv\/admin|assets.vhx.tv|cdn.vhx.tv|crystal.local|paypal.com/i)?"":(e=new RegExp(i.settings.site.domain,"g"),t=new RegExp(i.settings.site.host,"g"),document.referrer.match(e)||document.referrer.match(t)?"":(r=(r=(r=r.replace(/https?:\/\/(www\.)?/,"")).replace(/\/$/,"")).substring(0,255),-1!==navigator.userAgent.toLowerCase().indexOf("fbav")&&0===r.length?"m.facebook.com":-1!==navigator.userAgent.toLowerCase().indexOf("twitter")&&0===r.length?"mobile.twitter.com":r))},o.getPlatform=function(){return navigator.userAgent.match(/iPad|iPhone|iPod/i)?"ios":navigator.userAgent.match(/Android/i)?"android":navigator.userAgent.match(/Windows/i)?"windows":navigator.userAgent.match(/Macintosh/i)?"macintosh":navigator.userAgent.match(/Linux/i)?"linux":void 0},o.getAffiliate=function(){return o.getQueryParam("affiliate")},o.getCampaign=function(){return o.getQueryParam("campaign")||o.getCampaignFromReferrer()},o.getCampaignFromReferrer=function(){var e=o.getCookieValue("referrer_url").split("campaign=")[1];return e||""},o.getCountry=function(){return i.settings.geo.country},o.getQueryParam=function(e){var r={};return window.location.search&&location.search.slice(1).split("&").forEach(function(e){var t=e.split("=");t[0]=decodeURIComponent(t[0]),t[1]=decodeURIComponent(t[1]),r[t[0]]="undefined"==typeof t[1]||t[1]}),r[e]||""},o.readCookie=function(){var e,t=("; "+document.cookie).split("; tracker=");return 2===t.length?(e=t.pop().split(";").shift(),JSON.parse(decodeURIComponent(e))):null},o.getCookieValue=function(e){var t=new RegExp("(?:(?:^|.*; *)"+e+" *= *([^;]*).*$)|^.*$");return document.cookie.replace(t,"$1")},o.writeCookie=function(){for(var e in i.request.uid=Math.floor(1e13*Math.random()),i.request.site_id=i.settings.site.id,i.request)i.request[e]||delete i.request[e];return document.cookie="tracker=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="tracker="+encodeURIComponent(JSON.stringify(i.request))+";",!0},o.flushToCollector=function(e){var t=new Image,r="production"===i.settings.environment?"https://collector.vhx.tv":null,n=o.parameters(e).join("&");if(r&&0<n.length)return t.src=r+"/events.gif?"+n+"&_="+(new Date).getTime(),t},o.parameters=function(e){var t,r=[],n=e||o.readCookie();if(null!==n)for(t in n)n.hasOwnProperty(t)&&n[t]&&r.push(encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return r},o.pushMetric=function(e){try{return o.flushToCollector(e),!0}catch(t){console.log(t)}},o.init(),{init:o.init,params:o.parameters,pushMetric:o.pushMetric}},VHX.Tracker=VHX.Class.Tracker();